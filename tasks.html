<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Small_car</title>
    <script type="text/javascript" src="three.js"></script>
    <script type="text/javascript" src="TrackballControls.js"></script>
    <script type="text/javascript">
        var renderer,scene;
        var controls,camera,light,ambientlight,plane;
        var car;
        function init(){
            // render&scene
            renderer = new THREE.WebGLRenderer({
                canvas:document.getElementById('mainCanvas')
            });
            renderer.setClearColor(0x000000);
            renderer.shadowMapSoft = true;
            renderer.shadowMapEnabled = true;
            scene = new THREE.Scene();
            // camera
            camera = new THREE.OrthographicCamera(-20,20,20,-20,1,50);
            camera.position.set(15,7,15);
            camera.lookAt(new THREE.Vector3(0,0,0));
            scene.add(camera);
            //control
            controls = new THREE.TrackballControls( camera );
            controls.rotateSpeed = 1.0;
            controls.zoomSpeed = 1.2;
            controls.panSpeed = 0.8;
            controls.noZoom = false;
            controls.noPan = false;
            controls.staticMoving = true;
            controls.dynamicDampingFactor = 0.3;
            controls.keys = [ 65, 83, 68 ];


            //light:
            /*
            var light = new THREE.DirectionalLight(0xffffff,0.6);
            light.position.set(-20,20,20);
            light.castShadow=true;

            var light = new THREE.SpotLight(0xffffff,1,100,Math.PI/2,2);
            light.position.set(-20,30,20);
            //light.target = Vector3(0,0,0);
            */
            light = new THREE.PointLight(0xffffff,1,100,2);
            light.position.set(-20,40,20);
            light.castShadow = true;
            scene.add(light);

            ambientlight = new THREE.AmbientLight(0xffffff,0.3);
            scene.add(ambientlight);
            //plane:
            plane = new THREE.Mesh(new THREE.PlaneGeometry(50,50),
                new THREE.MeshLambertMaterial({
                    map: THREE.ImageUtils.loadTexture('2.jpg',{},function(){
                        renderer.render(scene,camera);
                    })
                }));
            plane.rotation.x= -Math.PI/2;
            plane.position.y= -(5+20/12+20/32);
            plane.receiveShadow=true;
            scene.add(plane);
            //car
            var materialBase = new THREE.MeshLambertMaterial({
                map: THREE.ImageUtils.loadTexture("1.jpg",{},function(){
                    renderer.render(scene,camera);
                }),
                overdraw: true
            });
            var materialWheel = new THREE.MeshLambertMaterial({
                color: 0x000000
            });
            id= drawCar(scene,materialBase,materialWheel,20);

            document.addEventListener('keydown',keyboarddown,false);

            renderer.render(scene,camera);
        }
        function drawCar(scene,materialBase,materialWheel,length){
            var carBase = new THREE.Mesh(new THREE.CubeGeometry(length,length/2,length/2,5,5,5),materialBase);
            var carWheel1 = new THREE.Mesh(new THREE.TorusGeometry(length/12,length/32,16,100,Math.PI*2),materialWheel);
            var carWheel2 = new THREE.Mesh(new THREE.TorusGeometry(length/12,length/32,16,100,Math.PI*2),materialWheel);
            var carWheel3 = new THREE.Mesh(new THREE.TorusGeometry(length/12,length/32,16,100,Math.PI*2),materialWheel);
            var carWheel4 = new THREE.Mesh(new THREE.TorusGeometry(length/12,length/32,16,100,Math.PI*2),materialWheel);
            var singleGeometry = new THREE.Geometry();
            carWheel1.position.set(-length/4,-length/4,length/4);
            carWheel2.position.set(length/4,-length/4,-length/4);
            carWheel3.position.set(-length/4,-length/4,-length/4);
            carWheel4.position.set(length/4,-length/4,length/4);
            carBase.updateMatrix();
            carWheel1.updateMatrix();
            carWheel2.updateMatrix();
            carWheel3.updateMatrix();
            carWheel4.updateMatrix();
            singleGeometry.merge(carBase.geometry,carBase.matrix);
            singleGeometry.merge(carWheel1.geometry,carWheel1.matrix);
            singleGeometry.merge(carWheel2.geometry,carWheel2.matrix);
            singleGeometry.merge(carWheel3.geometry,carWheel3.matrix);
            singleGeometry.merge(carWheel4.geometry,carWheel4.matrix);
            car = new THREE.Mesh(singleGeometry);
            carBase.castShadow=true;
            carWheel1.castShadow=true;
            carWheel2.castShadow=true;
            carWheel3.castShadow=true;
            carWheel4.castShadow=true;
            carBase.receiveShadow=true;
            carWheel1.receiveShadow=true;
            carWheel2.receiveShadow=true;
            carWheel3.receiveShadow=true;
            carWheel4.receiveShadow=true;
            scene.add(car);
            //scene.add(carBase);
            //scene.add(carWheel1);
            //scene.add(carWheel2);
            //scene.add(carWheel3);
            //scene.add(carWheel4);
        }
        function animate() {
            requestAnimationFrame( animate );
            controls.update();
            renderer.render(scene,camera);
        }
        function keyboarddown(){
            var speed = 1;
            var rotateSpeed = Math.PI/30;
            if (event.keyCode == 87){ //w
                car.translateX(-speed);
            }
            else if (event.keyCode ==83){ //s
                car.translateX(speed);
            }
            else if (event.keyCode ==65){
                car.rotation.y += rotateSpeed;
                car.translateX(-speed);
            }
            else if (event.keyCode ==68){
                car.rotation.y -= rotateSpeed;
                car.translateX(-speed);
            }
        }
    </script>
</head>
<body onload="init(),animate()">
    <canvas id="mainCanvas" width="400px" height="300px"></canvas>
</body>
</html>